name: CI Docker Build & Push

on:
  push:
    branches:
      - lab-docker

jobs:
  docker:
    runs-on: ubuntu-latest

    #environment: dev

    env:
      IMAGE_NAME: nom_iame_docker
      IMAGE_TAG: 1.0.0
      DOCKER_HUB_REGISTRY: docker.io/mon_nom_utilisateur

    steps:
      - name: Récupération du code
        uses: actions/checkout@v4
      
      - name: Test Variables
        run: |
          echo "Variable MYVAR  ${{ vars.MYVAR }} "
          echo "Variable IMAGE_NAME $IMAGE_NAME"
          echo "Variable DOCKER_HUB_REGISTRY  $DOCKER_HUB_REGISTRY "

      - name: Connexion à Docker Hub
        run: echo "${{ secrets.DOCKERHUB_TOKEN }}" | docker login \
             -u "${{ secrets.DOCKERHUB_USERNAME }}" --password-stdin

      - name: Build de l’image Docker
        run: |
          docker build -t $DOCKER_HUB_REGISTRY/$IMAGE_NAME:$IMAGE_TAG .
        
      - name: Test de l’image Docker
        run: |
          docker image ls $DOCKER_HUB_REGISTRY/$IMAGE_NAME:$IMAGE_TAG 

      - name: Push de l’image Docker
        run: |
          docker push $DOCKER_HUB_REGISTRY/$IMAGE_NAME:$IMAGE_TAG